<div class="main-content position-relative max-height-vh-100 h-100 create-immobilisation-form">
    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-12">
          <!-- Header Section -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <h3 class="mb-0 text-dark">
                    <i class="fas fa-plus-circle me-2 text-primary"></i>
                    {{immoId ? ("Edit"|translate) : ("CreateU"|translate)}} {{"Immobilisation"|translate}}
                  </h3>
                  <p class="text-sm text-secondary mb-0">
                    {{immoId ? ("UpdateAssetInformation"|translate) : ("AddNewAssetToInventory"|translate)}}
                  </p>
                </div>
                <div>
                  <button class="btn btn-outline-secondary btn-sm" routerLink="/admin/immobilisations">
                    <i class="fas fa-arrow-left me-2"></i>{{"Back"|translate}}
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Progress Steps -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card bg-gradient-primary">
                <div class="card-body p-3">
                  <div class="d-flex align-items-center">
                    <div class="step-indicator active me-3">
                      <i class="fas fa-info-circle text-white"></i>
                    </div>
                    <div class="text-white">
                      <h6 class="mb-0">{{"Step"|translate}} 1</h6>
                      <p class="text-xs mb-0 opacity-8">{{"BasicInformation"|translate}}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Form Card -->
          <div class="card shadow-lg">
            <div class="card-header bg-gradient-light p-4">
              <div class="d-flex align-items-center">
                <div class="icon icon-shape icon-sm bg-gradient-primary shadow text-center me-3">
                  <i class="fas fa-cube text-white"></i>
                </div>
                <div>
                  <h6 class="mb-0">{{"AssetInformation"|translate}}</h6>
                  <p class="text-xs text-secondary mb-0">{{"FillRequiredFields"|translate}}</p>
                </div>
              </div>
            </div>
            
            <div class="card-body p-4">
              <!-- Error Display -->
              @if(error$|async;as error){
                @if(error.status){
                  <div class="alert alert-danger alert-dismissible fade show" role="alert">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  {{error.message}}
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                }
                
              }

              <form [formGroup]="immoForm">
                <!-- Section 1: Basic Information -->
                <div class="row mb-4">
                  <div class="col-12">
                    <h6 class="text-dark mb-3">
                      <i class="fas fa-clipboard-list me-2 text-primary"></i>
                      {{"BasicInformation"|translate}}
                    </h6>
                    <hr class="horizontal dark mt-0 mb-4">
                  </div>
                  
                  <div class="col-lg-4 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-tag me-2 text-primary"></i>
                        {{"Designation"|translate}} 
                        @if(isFieldRequired('name')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <input 
                        class="form-control form-control-lg" 
                        type="text" 
                        formControlName="name" 
                        placeholder="{{'EnterAssetName'|translate}}"
                        [class.is-invalid]="btnSubmit && immoForm.get('name')?.invalid"
                        [class.is-valid]="immoForm.get('name')?.valid">
                      @if(btnSubmit && immoForm.invalid && immoForm.get('name')?.invalid) {
                        <div class="invalid-feedback">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('name'))}}
                        </div>
                      }
                    </div>
                  </div>

                  <div class="col-lg-4 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-star me-2 text-warning"></i>
                        {{"Mark"|translate}}
                        @if(isFieldRequired('mark')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <input 
                        class="form-control form-control-lg" 
                        type="text" 
                        formControlName="mark" 
                        placeholder="{{'EnterBrand'|translate}}"
                        [class.is-invalid]="btnSubmit && immoForm.get('mark')?.invalid"
                        [class.is-valid]="immoForm.get('mark')?.valid">
                      @if(btnSubmit && immoForm.invalid && immoForm.get('mark')?.invalid) {
                        <div class="invalid-feedback">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('mark'))}}
                        </div>
                      }
                    </div>
                  </div>

                  <div class="col-lg-4 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-cogs me-2 text-info"></i>
                        {{"Model"|translate}}
                        @if(isFieldRequired('model')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <input 
                        class="form-control form-control-lg" 
                        type="text" 
                        formControlName="model" 
                        placeholder="{{'EnterModel'|translate}}"
                        [class.is-invalid]="btnSubmit && immoForm.get('model')?.invalid"
                        [class.is-valid]="immoForm.get('model')?.valid">
                      @if(btnSubmit && immoForm.invalid && immoForm.get('model')?.invalid) {
                        <div class="invalid-feedback">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('model'))}}
                        </div>
                      }
                    </div>
                  </div>
                </div>

                <!-- Section 2: Classification -->
                <div class="row mb-4">
                  <div class="col-12">
                    <h6 class="text-dark mb-3">
                      <i class="fas fa-sitemap me-2 text-primary"></i>
                      {{"Classification"|translate}}
                    </h6>
                    <hr class="horizontal dark mt-0 mb-4">
                  </div>

                  <div class="col-lg-3 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-layer-group me-2 text-primary"></i>
                        {{"Categorie"|translate}} 
                        @if(isFieldRequired('categorie_id')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <ng-select
                        [items]="categories$|async"
                        bindLabel="name"
                        bindValue="id"
                        [addTag]="addTagNowRef"
                        formControlName="categorie_id"
                        [closeOnSelect]="true"
                        [searchable]="true"
                        [clearable]="true"
                        placeholder="{{'SelectCategory'|translate}}"
                        [class.is-invalid]="btnSubmit && immoForm.get('categorie_id')?.invalid"
                        [class.is-valid]="immoForm.get('categorie_id')?.valid">
                      </ng-select>
                      @if(btnSubmit && immoForm.invalid && immoForm.get('categorie_id')?.invalid) {
                        <div class="invalid-feedback d-block">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('categorie_id'))}}
                        </div>
                      }
                    </div>
                  </div>

                  <div class="col-lg-3 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-building me-2 text-info"></i>
                        {{"Structure"|translate}} 
                        @if(isFieldRequired('structure_id')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <ng-select
                        [items]="structures$|async"
                        bindLabel="name"
                        bindValue="id"
                        [addTag]="addTagNowStrRef"
                        formControlName="structure_id"
                        [closeOnSelect]="true"
                        [searchable]="true"
                        [clearable]="true"
                        placeholder="{{'SelectStructure'|translate}}"
                        [class.is-invalid]="btnSubmit && immoForm.get('structure_id')?.invalid"
                        [class.is-valid]="immoForm.get('structure_id')?.valid">
                      </ng-select>
                      @if(btnSubmit && immoForm.invalid && immoForm.get('structure_id')?.invalid) {
                        <div class="invalid-feedback d-block">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('structure_id'))}}
                        </div>
                      }
                    </div>
                  </div>

                  <div class="col-lg-3 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-truck me-2 text-warning"></i>
                        {{"Fournisseur"|translate}} 
                        @if(isFieldRequired('fournisseur_id')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <ng-select
                        [items]="fournisseurs$|async"
                        bindLabel="raison_social"
                        bindValue="id"
                        [addTag]="addTagNowFourRef"
                        formControlName="fournisseur_id"
                        [closeOnSelect]="true"
                        [searchable]="true"
                        [clearable]="true"
                        placeholder="{{'SelectSupplier'|translate}}"
                        [class.is-invalid]="btnSubmit && immoForm.get('fournisseur_id')?.invalid"
                        [class.is-valid]="immoForm.get('fournisseur_id')?.valid">
                      </ng-select>
                      @if(btnSubmit && immoForm.invalid && immoForm.get('fournisseur_id')?.invalid) {
                        <div class="invalid-feedback d-block">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('fournisseur_id'))}}
                        </div>
                      }
                    </div>
                  </div>

          
                </div>

                <!-- Section 3: Financial Information -->
                <div class="row mb-4">
                  <div class="col-12">
                    <h6 class="text-dark mb-3">
                      <i class="fas fa-euro-sign me-2 text-primary"></i>
                      {{"FinancialInformation"|translate}}
                    </h6>
                    <hr class="horizontal dark mt-0 mb-4">
                  </div>

                  <div class="col-lg-3 col-md-6 col-12" *ngIf="!immoId">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-sort-numeric-up me-2 text-success"></i>
                        {{"quantity"|translate}} 
                        @if(isFieldRequired('quantity')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <input 
                        class="form-control form-control-lg" 
                        type="number" 
                        formControlName="quantity" 
                        placeholder="{{'EnterQuantity'|translate}}"
                        min="1"
                        [class.is-invalid]="btnSubmit && immoForm.get('quantity')?.invalid"
                        [class.is-valid]="immoForm.get('quantity')?.valid">
                      @if(btnSubmit && immoForm.invalid && immoForm.get('quantity')?.invalid) {
                        <div class="invalid-feedback">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('quantity'))}}
                        </div>
                      }
                    </div>
                  </div>

                  <div class="col-lg-3 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-money-bill-wave me-2 text-warning"></i>
                        {{"Unit Price"|translate}} 
                        @if(isFieldRequired('unit_price')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <div class="input-group">
                        <span class="input-group-text">CFA</span>
                        <input 
                          class="form-control form-control-lg" 
                          type="number" 
                          formControlName="unit_price" 
                          placeholder="{{'EnterPrice'|translate}}"
                          min="0"
                          step="0.01"
                          [class.is-invalid]="btnSubmit && immoForm.get('unit_price')?.invalid"
                          [class.is-valid]="immoForm.get('unit_price')?.valid">
                      </div>
                      @if(btnSubmit && immoForm.invalid && immoForm.get('unit_price')?.invalid) {
                        <div class="invalid-feedback">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('unit_price'))}}
                        </div>
                      }
                    </div>
                  </div>
                </div>

                <!-- Section 4: Administrative Information -->
                <div class="row mb-4">
                  <div class="col-12">
                    <h6 class="text-dark mb-3">
                      <i class="fas fa-file-alt me-2 text-primary"></i>
                      {{"AdministrativeInformation"|translate}}
                    </h6>
                    <hr class="horizontal dark mt-0 mb-4">
                  </div>

                  <div class="col-lg-3 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-receipt me-2 text-info"></i>
                        {{"Num bon commande"|translate}}
                        @if(isFieldRequired('num_bon_commande')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <input 
                        class="form-control form-control-lg" 
                        type="text" 
                        formControlName="num_bon_commande" 
                        placeholder="{{'EnterOrderNumber'|translate}}"
                        [class.is-invalid]="btnSubmit && immoForm.get('num_bon_commande')?.invalid"
                        [class.is-valid]="immoForm.get('num_bon_commande')?.valid">
                      @if(btnSubmit && immoForm.invalid && immoForm.get('num_bon_commande')?.invalid) {
                        <div class="invalid-feedback">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('num_bon_commande'))}}
                        </div>
                      }
                    </div>
                  </div>

                  <div class="col-lg-3 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-file-signature me-2 text-secondary"></i>
                        {{"Num process verbal"|translate}}
                        @if(isFieldRequired('num_proces_verbal')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <input 
                        class="form-control form-control-lg" 
                        type="text" 
                        formControlName="num_proces_verbal" 
                        placeholder="{{'EnterProcessNumber'|translate}}"
                        [class.is-invalid]="btnSubmit && immoForm.get('num_proces_verbal')?.invalid"
                        [class.is-valid]="immoForm.get('num_proces_verbal')?.valid">
                      @if(btnSubmit && immoForm.invalid && immoForm.get('num_proces_verbal')?.invalid) {
                        <div class="invalid-feedback">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('num_proces_verbal'))}}
                        </div>
                      }
                    </div>
                  </div>

                  <div class="col-lg-3 col-md-6 col-12">
                    <div class="form-group">
                      <label class="form-label text-dark">
                        <i class="fas fa-calendar-alt me-2 text-success"></i>
                        {{"date_receipt"|translate}} 
                        @if(isFieldRequired('date_of_receipt')) {
                          <span class="text-danger">*</span>
                        }
                      </label>
                      <input 
                        class="form-control form-control-lg" 
                        type="date" 
                        formControlName="date_of_receipt"
                        [class.is-invalid]="btnSubmit && immoForm.get('date_of_receipt')?.invalid"
                        [class.is-valid]="immoForm.get('date_of_receipt')?.valid">
                      @if(btnSubmit && immoForm.invalid && immoForm.get('date_of_receipt')?.invalid) {
                        <div class="invalid-feedback">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          {{getFormControlErrorText(immoForm.get('date_of_receipt'))}}
                        </div>
                      }
                    </div>
                  </div>


                </div>

                <!-- Section 5: Description -->
             
              </form>
            </div>

            <!-- Actions Footer -->
            <div class="card-footer bg-gray-100 p-4">
              <div class="row">
                <div class="col-12">
                  @if(loading$|async) {
                    <div class="text-center">
                      <app-custom-spinner></app-custom-spinner>
                      <p class="text-sm text-secondary mt-2">{{"Processing"|translate}}...</p>
                    </div>
                  }
                  
                  <div class="d-flex justify-content-end align-items-center">
                    <button 
                      type="button" 
                      class="btn btn-outline-secondary me-3"
                      (click)="immoForm.reset()"
                      >
                      <i class="fas fa-undo me-2"></i>
                      {{"Reset"|translate}}
                    </button>
                    
                    <button 
                      type="submit" 
                      class="btn btn-lg shadow-sm"
                      [ngClass]="immoId ? 'btn-warning' : 'btn-primary'"
                      (click)="submitForm()"
                      >
                      <i class="fas" [ngClass]="immoId ? 'fa-edit' : 'fa-plus'" [class.me-2]="!(loading$|async)"></i>
                      @if(loading$|async) {
                        <span class="spinner-border spinner-border-sm me-2"></span>
                      }
                      {{immoId ? ("Update"|translate) : ("Create"|translate)}}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>